(()=>{function h(L,{variant:a="primary",delay:g=4e3}={}){let c=document.querySelector(".toast-container");if(!c){console.warn("[toast] Missing .toast-container");return}let n=document.createElement("div");n.className=`toast align-items-center text-bg-${a} border-0`,n.role="alert",n.ariaLive="assertive",n.ariaAtomic="true",n.innerHTML=`<div class="d-flex"><div class="toast-body">${L}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`,c.appendChild(n),window.bootstrap&&window.bootstrap.Toast&&(new window.bootstrap.Toast(n,{autohide:!0,delay:g}).show(),n.addEventListener("hidden.bs.toast",()=>n.remove()))}(function(){let a=1,g="",c=document.getElementById("phrasesTableBody"),n=document.getElementById("pagination"),b=document.getElementById("loadingSpinner"),u=document.getElementById("phraseModal"),f=null;u&&window.bootstrap&&(f=window.bootstrap.Modal.getOrCreateInstance(u));let I=document.getElementById("phraseForm"),l=document.getElementById("phraseInput"),S=document.getElementById("scoreInput"),w=document.getElementById("phraseIdInput"),P=u.querySelector(".modal-title");function v(){b.classList.remove("d-none","fade")}function E(){b.classList.add("fade"),setTimeout(()=>b.classList.add("d-none"),150)}function M(e){let t=e.totalPages||1;if(n.innerHTML="",t<=1)return;let o=5,r=Math.max(1,a-Math.floor(o/2)),d=Math.min(t,r+o-1),i=(s,B=null,T=!1)=>{let y=document.createElement("li");y.className=`page-item ${s===a?"active":""} ${T?"disabled":""}`;let p=document.createElement("a");p.className="page-link",p.href="#",p.textContent=B||s,p.addEventListener("click",C=>{C.preventDefault(),!T&&(a=s,m())}),y.appendChild(p),n.appendChild(y)};i(1,"\xAB",a===1),i(Math.max(1,a-1),"\u2039",a===1);for(let s=r;s<=d;s++)i(s);i(Math.min(t,a+1),"\u203A",a===t),i(t,"\xBB",a===t)}function _(){if(c.innerHTML="",!window.__phrasesPage||!Array.isArray(window.__phrasesPage.items)||window.__phrasesPage.items.length===0){let e=document.createElement("tr");e.innerHTML='<td colspan="3" class="text-muted">No phrases found.</td>',c.appendChild(e)}else window.__phrasesPage.items.forEach(e=>c.appendChild(x(e)));M(window.__phrasesPage.pagination)}function x(e){let t=document.createElement("tr");return t.innerHTML=`
      <td>${e.phrase}</td>
      <td>${Number(e.score)}</td>
      <td class="text-end">
        <button class="btn btn-sm btn-outline-primary" data-edit-phrase data-id="${e.id}" title="Edit" data-bs-toggle="modal" data-bs-target="#phraseModal">
          <i class="bi bi-pencil-square"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger" data-delete-phrase data-id="${e.id}" title="Delete">
          <i class="bi bi-trash"></i>
        </button>
      </td>
    `,t}async function m(){v();try{let e=new URLSearchParams({page:String(a),limit:String(10),search:g}),t=await fetch(`/api/v3/bad-phrases?${e.toString()}`,{credentials:"same-origin"});if(!t.ok)throw new Error(`${t.status} ${t.statusText}`);let o=await t.json();window.__phrasesPage=o,_()}catch(e){console.error(e),c.innerHTML='<tr><td colspan="3" class="text-danger">Error loading phrases.</td></tr>'}finally{E()}}document.getElementById("searchForm").addEventListener("submit",e=>{e.preventDefault(),g=document.getElementById("phraseSearchInput").value||"",a=1,a=1,m()}),u.addEventListener("show.bs.modal",e=>{let t=e.relatedTarget,o=t?t.getAttribute("data-id"):null;if(I.reset(),w.value="",o){let r=window.__phrasesPage.items.find(d=>String(d.id)===String(o));r&&(P.textContent="Edit Phrase",w.value=r.id,l.value=r.phrase,S.value=r.score)}else P.textContent="Create Phrase"}),u.addEventListener("shown.bs.modal",()=>{if(l){l.focus();let e=l.value;l.value="",l.value=e}}),I.addEventListener("submit",async e=>{e.preventDefault();let t=w.value,o=t?"PUT":"POST",r=t?`/api/v3/bad-phrases/${t}`:"/api/v3/bad-phrases",d={phrase:l.value.trim(),score:Number(S.value||.5)};try{v();let i=await fetch(r,{method:o,headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(d)});if(!i.ok){let s=await i.json().catch(()=>({}));throw new Error(s.error||"Save failed")}u.addEventListener("hidden.bs.modal",()=>{let s=document.querySelector(".modal-backdrop");s&&s.remove(),h("Saved",{variant:"success"}),m()},{once:!0}),f&&f.hide()}catch(i){console.error(i),h(i.message||"Error saving",{variant:"danger"})}finally{E()}}),document.body.addEventListener("click",async e=>{let t=e.target.closest("[data-delete-phrase]"),o=e.target.closest("[data-edit-phrase]");if(t){let r=t.getAttribute("data-id");if(!confirm("Delete this phrase?"))return;try{if(v(),!(await fetch(`/api/v3/bad-phrases/${r}`,{method:"DELETE",credentials:"same-origin"})).ok)throw new Error("Delete failed");h("Deleted",{variant:"success"}),m()}catch(d){console.error(d),h("Delete failed",{variant:"danger"})}finally{E()}}}),document.addEventListener("DOMContentLoaded",m)})();})();
