{
  "version": 3,
  "sources": ["../js/lib/toast.js", "../js/admin-countries.js"],
  "sourcesContent": ["export function showToast(message, { variant = 'primary', delay = 4000 } = {}) {\n  const container = document.querySelector('.toast-container');\n  if (!container) {\n    console.warn('[toast] Missing .toast-container');\n    return;\n  }\n  const el = document.createElement('div');\n  el.className = `toast align-items-center text-bg-${variant} border-0`;\n  el.role = 'alert';\n  el.ariaLive = 'assertive';\n  el.ariaAtomic = 'true';\n  el.innerHTML = `<div class=\"d-flex\"><div class=\"toast-body\">${message}</div><button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button></div>`;\n  container.appendChild(el);\n  if (window.bootstrap && window.bootstrap.Toast) {\n    const toast = new window.bootstrap.Toast(el, { autohide: true, delay });\n    toast.show();\n    el.addEventListener('hidden.bs.toast', () => el.remove());\n  }\n}\n", "import { showToast } from './lib/toast.js';\n\nfunction $(sel, root = document) {\n  return root.querySelector(sel);\n}\n\n// Loading spinner helpers (match /admin/users behavior)\nfunction showLoadingSpinner() {\n  const spinner = document.getElementById('loadingSpinner');\n  if (spinner) {\n    spinner.classList.remove('d-none', 'fade');\n  }\n}\n\nfunction hideLoadingSpinner() {\n  const spinner = document.getElementById('loadingSpinner');\n  if (spinner) {\n    spinner.classList.add('fade');\n    setTimeout(() => {\n      spinner.classList.add('d-none');\n    }, 150); // Match Bootstrap's fade duration\n  }\n}\n\nfunction createRow(country) {\n  const tr = document.createElement('tr');\n  tr.dataset.code2 = country.country_code2;\n\n  tr.innerHTML = `\n    <td class=\"align-middle\">${flagCell(country.country_code2)}</td>\n    <td><code>${country.country_code2}</code></td>\n    <td>\n      <input type=\"text\" class=\"form-control form-control-sm code3-input\" value=\"${\n        country.country_code3 || ''\n      }\" maxlength=\"3\" />\n    </td>\n    <td>\n      <input type=\"text\" class=\"form-control form-control-sm name-input\" value=\"${\n        country.name || ''\n      }\" />\n    </td>\n    <td style=\"max-width:120px\">\n      <input type=\"number\" class=\"form-control form-control-sm score-input\" value=\"${\n        Number(country.score) || 0\n      }\" step=\"1\" />\n    </td>\n    <td class=\"text-end\">\n      <button class=\"btn btn-sm btn-primary save-btn\"><i class=\"bi bi-save\"></i> Save</button>\n    </td>\n  `;\n\n  const saveBtn = tr.querySelector('.save-btn');\n  saveBtn.addEventListener('click', async () => {\n    await saveRow(tr);\n  });\n  return tr;\n}\n\nfunction flagCell(code2) {\n  if (!code2 || code2 === '??') {\n    return '<span class=\"text-muted\">&mdash;</span>';\n  }\n  const c = code2.toLowerCase();\n  // Using dedicated /flags directory with lowercase ISO alpha-2 SVGs\n  return `<img src=\"/flags/${c}.svg\" loading=\"lazy\" alt=\"${code2} flag\" class=\"country-flag\" style=\"width:24px;height:18px;object-fit:cover;border:1px solid #dee2e6;border-radius:2px;background:#fff\" onerror=\"this.replaceWith(document.createElement('span'))\">`;\n}\n\nasync function fetchCountries() {\n  const res = await fetch('/api/v3/countries', { credentials: 'same-origin' });\n  if (!res.ok) {\n    throw new Error(`${res.status} ${res.statusText}`);\n  }\n  return res.json();\n}\n\nfunction applyFilters(data) {\n  const q = ($('#searchInput').value || '').trim().toLowerCase();\n  const scoreFilter = $('#scoreFilter').value;\n  let filtered = data;\n  if (q) {\n    filtered = filtered.filter((c) => {\n      return (\n        c.name.toLowerCase().includes(q) ||\n        (c.country_code2 || '').toLowerCase().includes(q) ||\n        (c.country_code3 || '').toLowerCase().includes(q)\n      );\n    });\n  }\n  if (scoreFilter === 'neg') {\n    filtered = filtered.filter((c) => Number(c.score) < 0);\n  }\n  if (scoreFilter === 'zero') {\n    filtered = filtered.filter((c) => Number(c.score) === 0);\n  }\n  if (scoreFilter === 'pos') {\n    filtered = filtered.filter((c) => Number(c.score) > 0);\n  }\n  return filtered;\n}\n\nasync function saveRow(tr) {\n  const code2 = tr.dataset.code2;\n  const name = tr.querySelector('.name-input').value.trim();\n  const country_code3 = tr.querySelector('.code3-input').value.trim().toUpperCase();\n  const score = Number(tr.querySelector('.score-input').value);\n  const btn = tr.querySelector('.save-btn');\n  try {\n    btn.disabled = true;\n    showLoadingSpinner();\n    const res = await fetch(`/api/v3/countries/${encodeURIComponent(code2)}`, {\n      method: 'PUT',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'same-origin',\n      body: JSON.stringify({ name, score, country_code3 })\n    });\n    if (!res.ok) {\n      throw new Error(`${res.status} ${res.statusText}`);\n    }\n    showToast('Saved', { variant: 'success' });\n  } catch (err) {\n    console.error(err);\n    showToast(`Save failed: ${err.message}`, { variant: 'danger' });\n  } finally {\n    btn.disabled = false;\n    hideLoadingSpinner();\n  }\n}\n\nfunction renderTable(data) {\n  const tbody = document.getElementById('countriesTbody');\n  tbody.innerHTML = '';\n  const rows = applyFilters(data);\n  if (rows.length === 0) {\n    const tr = document.createElement('tr');\n    tr.innerHTML = '<td colspan=\"6\" class=\"text-muted\">No results</td>';\n    tbody.appendChild(tr);\n  } else {\n    rows.forEach((c) => tbody.appendChild(createRow(c)));\n  }\n  document.getElementById('countSummary').textContent = `${rows.length} / ${data.length}`;\n}\n\nasync function init() {\n  if (!window.assertBootstrapReady || !window.assertBootstrapReady('admin-countries')) {\n    // continue anyway; only a console warn is emitted\n  }\n  try {\n    showLoadingSpinner();\n    const data = await fetchCountries();\n    const original = Array.isArray(data) ? data : [];\n    renderTable(original);\n    document.getElementById('filterForm').addEventListener('submit', (e) => {\n      e.preventDefault();\n      renderTable(original);\n    });\n    document.getElementById('searchInput').addEventListener('input', () => renderTable(original));\n    document.getElementById('scoreFilter').addEventListener('change', () => renderTable(original));\n  } catch (err) {\n    console.error(err);\n    const tbody = document.getElementById('countriesTbody');\n    tbody.innerHTML = `<tr><td colspan=\"5\" class=\"text-danger\">Failed to load: ${err.message}</td></tr>`;\n  } finally {\n    hideLoadingSpinner();\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', init);\n"],
  "mappings": ";;AAAO,WAAS,UAAU,SAAS,EAAE,UAAU,WAAW,QAAQ,IAAK,IAAI,CAAC,GAAG;AAC7E,UAAM,YAAY,SAAS,cAAc,kBAAkB;AAC3D,QAAI,CAAC,WAAW;AACd,cAAQ,KAAK,kCAAkC;AAC/C;AAAA,IACF;AACA,UAAM,KAAK,SAAS,cAAc,KAAK;AACvC,OAAG,YAAY,oCAAoC,OAAO;AAC1D,OAAG,OAAO;AACV,OAAG,WAAW;AACd,OAAG,aAAa;AAChB,OAAG,YAAY,+CAA+C,OAAO;AACrE,cAAU,YAAY,EAAE;AACxB,QAAI,OAAO,aAAa,OAAO,UAAU,OAAO;AAC9C,YAAM,QAAQ,IAAI,OAAO,UAAU,MAAM,IAAI,EAAE,UAAU,MAAM,MAAM,CAAC;AACtE,YAAM,KAAK;AACX,SAAG,iBAAiB,mBAAmB,MAAM,GAAG,OAAO,CAAC;AAAA,IAC1D;AAAA,EACF;;;AChBA,WAAS,EAAE,KAAK,OAAO,UAAU;AAC/B,WAAO,KAAK,cAAc,GAAG;AAAA,EAC/B;AAGA,WAAS,qBAAqB;AAC5B,UAAM,UAAU,SAAS,eAAe,gBAAgB;AACxD,QAAI,SAAS;AACX,cAAQ,UAAU,OAAO,UAAU,MAAM;AAAA,IAC3C;AAAA,EACF;AAEA,WAAS,qBAAqB;AAC5B,UAAM,UAAU,SAAS,eAAe,gBAAgB;AACxD,QAAI,SAAS;AACX,cAAQ,UAAU,IAAI,MAAM;AAC5B,iBAAW,MAAM;AACf,gBAAQ,UAAU,IAAI,QAAQ;AAAA,MAChC,GAAG,GAAG;AAAA,IACR;AAAA,EACF;AAEA,WAAS,UAAU,SAAS;AAC1B,UAAM,KAAK,SAAS,cAAc,IAAI;AACtC,OAAG,QAAQ,QAAQ,QAAQ;AAE3B,OAAG,YAAY;AAAA,+BACc,SAAS,QAAQ,aAAa,CAAC;AAAA,gBAC9C,QAAQ,aAAa;AAAA;AAAA,mFAG7B,QAAQ,iBAAiB,EAC3B;AAAA;AAAA;AAAA,kFAIE,QAAQ,QAAQ,EAClB;AAAA;AAAA;AAAA,qFAIE,OAAO,QAAQ,KAAK,KAAK,CAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAOJ,UAAM,UAAU,GAAG,cAAc,WAAW;AAC5C,YAAQ,iBAAiB,SAAS,YAAY;AAC5C,YAAM,QAAQ,EAAE;AAAA,IAClB,CAAC;AACD,WAAO;AAAA,EACT;AAEA,WAAS,SAAS,OAAO;AACvB,QAAI,CAAC,SAAS,UAAU,MAAM;AAC5B,aAAO;AAAA,IACT;AACA,UAAM,IAAI,MAAM,YAAY;AAE5B,WAAO,oBAAoB,CAAC,6BAA6B,KAAK;AAAA,EAChE;AAEA,iBAAe,iBAAiB;AAC9B,UAAM,MAAM,MAAM,MAAM,qBAAqB,EAAE,aAAa,cAAc,CAAC;AAC3E,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,IAAI,MAAM,GAAG,IAAI,MAAM,IAAI,IAAI,UAAU,EAAE;AAAA,IACnD;AACA,WAAO,IAAI,KAAK;AAAA,EAClB;AAEA,WAAS,aAAa,MAAM;AAC1B,UAAM,KAAK,EAAE,cAAc,EAAE,SAAS,IAAI,KAAK,EAAE,YAAY;AAC7D,UAAM,cAAc,EAAE,cAAc,EAAE;AACtC,QAAI,WAAW;AACf,QAAI,GAAG;AACL,iBAAW,SAAS,OAAO,CAAC,MAAM;AAChC,eACE,EAAE,KAAK,YAAY,EAAE,SAAS,CAAC,MAC9B,EAAE,iBAAiB,IAAI,YAAY,EAAE,SAAS,CAAC,MAC/C,EAAE,iBAAiB,IAAI,YAAY,EAAE,SAAS,CAAC;AAAA,MAEpD,CAAC;AAAA,IACH;AACA,QAAI,gBAAgB,OAAO;AACzB,iBAAW,SAAS,OAAO,CAAC,MAAM,OAAO,EAAE,KAAK,IAAI,CAAC;AAAA,IACvD;AACA,QAAI,gBAAgB,QAAQ;AAC1B,iBAAW,SAAS,OAAO,CAAC,MAAM,OAAO,EAAE,KAAK,MAAM,CAAC;AAAA,IACzD;AACA,QAAI,gBAAgB,OAAO;AACzB,iBAAW,SAAS,OAAO,CAAC,MAAM,OAAO,EAAE,KAAK,IAAI,CAAC;AAAA,IACvD;AACA,WAAO;AAAA,EACT;AAEA,iBAAe,QAAQ,IAAI;AACzB,UAAM,QAAQ,GAAG,QAAQ;AACzB,UAAM,OAAO,GAAG,cAAc,aAAa,EAAE,MAAM,KAAK;AACxD,UAAM,gBAAgB,GAAG,cAAc,cAAc,EAAE,MAAM,KAAK,EAAE,YAAY;AAChF,UAAM,QAAQ,OAAO,GAAG,cAAc,cAAc,EAAE,KAAK;AAC3D,UAAM,MAAM,GAAG,cAAc,WAAW;AACxC,QAAI;AACF,UAAI,WAAW;AACf,yBAAmB;AACnB,YAAM,MAAM,MAAM,MAAM,qBAAqB,mBAAmB,KAAK,CAAC,IAAI;AAAA,QACxE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,aAAa;AAAA,QACb,MAAM,KAAK,UAAU,EAAE,MAAM,OAAO,cAAc,CAAC;AAAA,MACrD,CAAC;AACD,UAAI,CAAC,IAAI,IAAI;AACX,cAAM,IAAI,MAAM,GAAG,IAAI,MAAM,IAAI,IAAI,UAAU,EAAE;AAAA,MACnD;AACA,gBAAU,SAAS,EAAE,SAAS,UAAU,CAAC;AAAA,IAC3C,SAAS,KAAK;AACZ,cAAQ,MAAM,GAAG;AACjB,gBAAU,gBAAgB,IAAI,OAAO,IAAI,EAAE,SAAS,SAAS,CAAC;AAAA,IAChE,UAAE;AACA,UAAI,WAAW;AACf,yBAAmB;AAAA,IACrB;AAAA,EACF;AAEA,WAAS,YAAY,MAAM;AACzB,UAAM,QAAQ,SAAS,eAAe,gBAAgB;AACtD,UAAM,YAAY;AAClB,UAAM,OAAO,aAAa,IAAI;AAC9B,QAAI,KAAK,WAAW,GAAG;AACrB,YAAM,KAAK,SAAS,cAAc,IAAI;AACtC,SAAG,YAAY;AACf,YAAM,YAAY,EAAE;AAAA,IACtB,OAAO;AACL,WAAK,QAAQ,CAAC,MAAM,MAAM,YAAY,UAAU,CAAC,CAAC,CAAC;AAAA,IACrD;AACA,aAAS,eAAe,cAAc,EAAE,cAAc,GAAG,KAAK,MAAM,MAAM,KAAK,MAAM;AAAA,EACvF;AAEA,iBAAe,OAAO;AACpB,QAAI,CAAC,OAAO,wBAAwB,CAAC,OAAO,qBAAqB,iBAAiB,GAAG;AAAA,IAErF;AACA,QAAI;AACF,yBAAmB;AACnB,YAAM,OAAO,MAAM,eAAe;AAClC,YAAM,WAAW,MAAM,QAAQ,IAAI,IAAI,OAAO,CAAC;AAC/C,kBAAY,QAAQ;AACpB,eAAS,eAAe,YAAY,EAAE,iBAAiB,UAAU,CAAC,MAAM;AACtE,UAAE,eAAe;AACjB,oBAAY,QAAQ;AAAA,MACtB,CAAC;AACD,eAAS,eAAe,aAAa,EAAE,iBAAiB,SAAS,MAAM,YAAY,QAAQ,CAAC;AAC5F,eAAS,eAAe,aAAa,EAAE,iBAAiB,UAAU,MAAM,YAAY,QAAQ,CAAC;AAAA,IAC/F,SAAS,KAAK;AACZ,cAAQ,MAAM,GAAG;AACjB,YAAM,QAAQ,SAAS,eAAe,gBAAgB;AACtD,YAAM,YAAY,2DAA2D,IAAI,OAAO;AAAA,IAC1F,UAAE;AACA,yBAAmB;AAAA,IACrB;AAAA,EACF;AAEA,WAAS,iBAAiB,oBAAoB,IAAI;",
  "names": []
}
