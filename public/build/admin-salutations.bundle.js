(()=>{function p(S,{variant:a="primary",delay:f=4e3}={}){let d=document.querySelector(".toast-container");if(!d){console.warn("[toast] Missing .toast-container");return}let n=document.createElement("div");n.className=`toast align-items-center text-bg-${a} border-0`,n.role="alert",n.ariaLive="assertive",n.ariaAtomic="true",n.innerHTML=`<div class="d-flex"><div class="toast-body">${S}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`,d.appendChild(n),window.bootstrap&&window.bootstrap.Toast&&(new window.bootstrap.Toast(n,{autohide:!0,delay:f}).show(),n.addEventListener("hidden.bs.toast",()=>n.remove()))}(function(){let a=1,f="",d=document.getElementById("salutationsTableBody"),n=document.getElementById("pagination"),h=document.getElementById("loadingSpinner"),c=document.getElementById("salutationModal"),b=null;c&&window.bootstrap&&(b=window.bootstrap.Modal.getOrCreateInstance(c));let I=document.getElementById("salutationForm"),l=document.getElementById("salutationPhraseInput"),w=document.getElementById("salutationScoreInput"),v=document.getElementById("salutationIdInput"),T=c.querySelector(".modal-title");function E(){h.classList.remove("d-none","fade")}function y(){h.classList.add("fade"),setTimeout(()=>h.classList.add("d-none"),150)}function M(t){let e=t.totalPages||1;if(n.innerHTML="",e<=1)return;let i=5,o=Math.max(1,a-Math.floor(i/2)),m=Math.min(e,o+i-1),r=(s,C=null,P=!1)=>{let L=document.createElement("li");L.className=`page-item ${s===a?"active":""} ${P?"disabled":""}`;let g=document.createElement("a");g.className="page-link",g.href="#",g.textContent=C||s,g.addEventListener("click",$=>{$.preventDefault(),!P&&(a=s,u())}),L.appendChild(g),n.appendChild(L)};r(1,"\xAB",a===1),r(Math.max(1,a-1),"\u2039",a===1);for(let s=o;s<=m;s++)r(s);r(Math.min(e,a+1),"\u203A",a===e),r(e,"\xBB",a===e)}function _(t){let e=document.createElement("tr");return e.innerHTML=`<td>${t.phrase}</td><td>${Number(t.score)}</td><td class='text-end'>
    <button class='btn btn-sm btn-outline-primary' data-edit-salutation data-id='${t.id}' title='Edit' data-bs-toggle='modal' data-bs-target='#salutationModal'><i class='bi bi-pencil-square'></i></button>
    <button class='btn btn-sm btn-outline-danger' data-delete-salutation data-id='${t.id}' title='Delete'><i class='bi bi-trash'></i></button>
    </td>`,e}function x(){if(d.innerHTML="",!window.__salutationsPage||!Array.isArray(window.__salutationsPage.items)||window.__salutationsPage.items.length===0){let t=document.createElement("tr");t.innerHTML='<td colspan="3" class="text-muted">No salutations found.</td>',d.appendChild(t)}else window.__salutationsPage.items.forEach(t=>d.appendChild(_(t)));M(window.__salutationsPage.pagination)}async function u(){E();try{let t=new URLSearchParams({page:String(a),limit:String(10),search:f}),e=await fetch(`/api/v3/salutations?${t.toString()}`,{credentials:"same-origin"});if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);let i=await e.json();window.__salutationsPage=i,x()}catch(t){console.error(t),d.innerHTML='<tr><td colspan="3" class="text-danger">Error loading salutations.</td></tr>'}finally{y()}}document.getElementById("searchForm").addEventListener("submit",t=>{t.preventDefault(),f=document.getElementById("salutationSearchInput").value||"",a=1,u()}),c.addEventListener("show.bs.modal",t=>{let e=t.relatedTarget,i=e?e.getAttribute("data-id"):null;if(I.reset(),v.value="",w.value="0",i){let o=window.__salutationsPage.items.find(m=>String(m.id)===String(i));o&&(T.textContent="Edit Salutation",v.value=o.id,l.value=o.phrase,w.value=o.score)}else T.textContent="Create Salutation"}),c.addEventListener("shown.bs.modal",()=>{if(l){l.focus();let t=l.value;l.value="",l.value=t}}),I.addEventListener("submit",async t=>{t.preventDefault();let e=v.value,i=e?"PUT":"POST",o=e?`/api/v3/salutations/${e}`:"/api/v3/salutations",m={phrase:l.value.trim(),score:Number(w.value||0)};try{E();let r=await fetch(o,{method:i,headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(m)});if(!r.ok){let s=await r.json().catch(()=>({}));throw new Error(s.error||"Save failed")}c.addEventListener("hidden.bs.modal",()=>{let s=document.querySelector(".modal-backdrop");s&&s.remove(),p("Saved",{variant:"success"}),u()},{once:!0}),b&&b.hide()}catch(r){console.error(r),p(r.message||"Error saving",{variant:"danger"})}finally{y()}}),document.body.addEventListener("click",async t=>{let e=t.target.closest("[data-delete-salutation]");if(e){let i=e.getAttribute("data-id");if(!confirm("Delete this salutation?"))return;try{if(E(),!(await fetch(`/api/v3/salutations/${i}`,{method:"DELETE",credentials:"same-origin"})).ok)throw new Error("Delete failed");p("Deleted",{variant:"success"}),u()}catch(o){console.error(o),p("Delete failed",{variant:"danger"})}finally{y()}}}),document.addEventListener("DOMContentLoaded",u)})();})();
