(()=>{typeof window.assertBootstrapReady=="function"&&window.assertBootstrapReady("api-keys");var c=window.bootstrap?window.bootstrap.Modal:null;document.addEventListener("DOMContentLoaded",()=>{let k=document.getElementById("createKeyBtn"),y=document.getElementById("loadingSpinner"),d=document.getElementById("apiKeysTable").querySelector("tbody"),m=document.querySelector(".toast-container"),i=document.getElementById("keyModal"),p=c?c.getOrCreateInstance(i):null,f=document.getElementById("keyModalLabel"),g=document.getElementById("keyForm"),w=document.getElementById("keyId"),u=document.getElementById("keyLabel"),h=document.getElementById("showKeyModal"),I=c?c.getOrCreateInstance(h):null,E=document.getElementById("newApiKey"),r=document.getElementById("copyKeyBtn"),a=(n,e="success")=>{let t=document.createElement("div");if(t.className=`toast align-items-center text-white bg-${e} border-0`,t.role="alert",t.ariaLive="assertive",t.ariaAtomic="true",t.innerHTML=`
      <div class="d-flex">
        <div class="toast-body">${n}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `,!m){console.error("Toast container not found!");return}m.appendChild(t),window.bootstrap&&(new window.bootstrap.Toast(t,{autohide:!0,delay:5e3}).show(),t.addEventListener("hidden.bs.toast",()=>t.remove()))},L=()=>{y.classList.remove("d-none","fade")},T=()=>{y.classList.add("fade"),setTimeout(()=>{y.classList.add("d-none")},150)},l=async()=>{L();try{let n=await fetch("/api/v3/api-keys");if(!n.ok)throw new Error("Failed to fetch API keys");let e=await n.json();A(e)}catch(n){console.error(n),d.innerHTML='<tr><td colspan="2" class="text-center text-danger">Error loading API keys.</td></tr>'}finally{T()}},A=n=>{if(d.innerHTML="",n.length===0){d.innerHTML='<tr><td colspan="2" class="text-center text-muted">No API keys found.</td></tr>';return}n.forEach(e=>{let t=document.createElement("tr");t.dataset.keyId=e.id,t.innerHTML=`
        <td>${e.label}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-secondary edit-btn" data-id="${e.id}" data-label="${e.label}" title="Edit key">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${e.id}" title="Delete key">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `,d.appendChild(t)})};i.addEventListener("show.bs.modal",n=>{let e=n.relatedTarget,t=e?e.getAttribute("data-id"):null,o=e?e.getAttribute("data-label"):"";g.reset(),w.value=t||"",u.value=o||"",f.textContent=t?"Edit API Key":"Create API Key"}),i.addEventListener("shown.bs.modal",()=>{u.focus()}),g.addEventListener("submit",async n=>{n.preventDefault();let e=w.value,t=u.value,o=e?`/api/v3/api-keys/${e}`:"/api/v3/api-keys",v=e?"PUT":"POST";try{let s=await fetch(o,{method:v,headers:{"Content-Type":"application/json"},body:JSON.stringify({label:t})});if(!s.ok){let b=await s.json().catch(()=>({message:"Failed to save key"}));throw new Error(b.message)}p.hide(),i.addEventListener("hidden.bs.modal",async()=>{if(v==="POST"){let{apiKey:b}=await s.json();E.value=b,I.show()}else a("API Key updated successfully."),await l()},{once:!0})}catch(s){console.error(s),a(s.message||"Error saving API key.","danger")}});let B=async n=>{if(confirm("Are you sure you want to delete this API key?"))try{let e=await fetch(`/api/v3/api-keys/${n}`,{method:"DELETE"});if(!e.ok){let t=await e.json().catch(()=>({message:"Failed to delete key"}));throw new Error(t.message)}a("API Key deleted successfully."),await l()}catch(e){console.error(e),a(e.message||"Error deleting API key.","danger")}};k.addEventListener("click",()=>{p.show()}),d.addEventListener("click",n=>{let e=n.target.closest(".edit-btn");if(e){let o=document.createElement("button");o.style.display="none",o.setAttribute("data-bs-toggle","modal"),o.setAttribute("data-bs-target","#keyModal"),o.setAttribute("data-id",e.dataset.id),o.setAttribute("data-label",e.dataset.label),document.body.appendChild(o),o.click(),document.body.removeChild(o);return}let t=n.target.closest(".delete-btn");t&&B(t.dataset.id)}),r.addEventListener("click",()=>{navigator.clipboard.writeText(E.value).then(()=>{let n=r.innerHTML;r.innerHTML='<i class="bi bi-check-lg"></i>',a("Copied to clipboard!"),setTimeout(()=>{r.innerHTML=n},2e3)},()=>{a("Failed to copy.","danger")})}),h.addEventListener("hidden.bs.modal",l),l()});})();
