{
  "version": 3,
  "sources": ["../js/api-keys.js"],
  "sourcesContent": ["// Use global bootstrap provided by main bundle instead of importing again\nif (typeof window.assertBootstrapReady === 'function') {\n  window.assertBootstrapReady('api-keys');\n}\nconst Modal = window.bootstrap ? window.bootstrap.Modal : null;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const createKeyBtn = document.getElementById('createKeyBtn');\n  const loadingSpinner = document.getElementById('loadingSpinner');\n  const apiKeysTable = document.getElementById('apiKeysTable');\n  const tableBody = apiKeysTable.querySelector('tbody');\n  const toastContainer = document.querySelector('.toast-container');\n\n  // Modals\n  const keyModalEl = document.getElementById('keyModal');\n  const keyModal = Modal ? Modal.getOrCreateInstance(keyModalEl) : null;\n  const keyModalLabel = document.getElementById('keyModalLabel');\n  const keyForm = document.getElementById('keyForm');\n  const keyIdInput = document.getElementById('keyId');\n  const keyLabelInput = document.getElementById('keyLabel');\n\n  const showKeyModalEl = document.getElementById('showKeyModal');\n  const showKeyModal = Modal ? Modal.getOrCreateInstance(showKeyModalEl) : null;\n  const newApiKeyInput = document.getElementById('newApiKey');\n  const copyKeyBtn = document.getElementById('copyKeyBtn');\n\n  const showToast = (message, type = 'success') => {\n    const toastEl = document.createElement('div');\n    toastEl.className = `toast align-items-center text-white bg-${type} border-0`;\n    toastEl.role = 'alert';\n    toastEl.ariaLive = 'assertive';\n    toastEl.ariaAtomic = 'true';\n    toastEl.innerHTML = `\n      <div class=\"d-flex\">\n        <div class=\"toast-body\">${message}</div>\n        <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n      </div>\n    `;\n    if (!toastContainer) {\n      console.error('Toast container not found!');\n      return;\n    }\n    toastContainer.appendChild(toastEl);\n    if (window.bootstrap) {\n      const toast = new window.bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });\n      toast.show();\n      toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());\n    }\n  };\n\n  const showLoadingSpinner = () => {\n    loadingSpinner.classList.remove('d-none', 'fade');\n  };\n\n  const hideLoadingSpinner = () => {\n    loadingSpinner.classList.add('fade');\n    setTimeout(() => {\n      loadingSpinner.classList.add('d-none');\n    }, 150); // Match Bootstrap's fade duration\n  };\n\n  const fetchKeys = async () => {\n    showLoadingSpinner();\n    try {\n      const response = await fetch('/api/v3/api-keys');\n      if (!response.ok) {\n        throw new Error('Failed to fetch API keys');\n      }\n      const keys = await response.json();\n      renderTable(keys);\n    } catch (error) {\n      console.error(error);\n      tableBody.innerHTML = `<tr><td colspan=\"2\" class=\"text-center text-danger\">Error loading API keys.</td></tr>`;\n    } finally {\n      hideLoadingSpinner();\n    }\n  };\n\n  const renderTable = (keys) => {\n    tableBody.innerHTML = '';\n    if (keys.length === 0) {\n      tableBody.innerHTML = `<tr><td colspan=\"2\" class=\"text-center text-muted\">No API keys found.</td></tr>`;\n      return;\n    }\n    keys.forEach((key) => {\n      const row = document.createElement('tr');\n      row.dataset.keyId = key.id;\n      row.innerHTML = `\n        <td>${key.label}</td>\n        <td class=\"text-end\">\n          <button class=\"btn btn-sm btn-outline-secondary edit-btn\" data-id=\"${key.id}\" data-label=\"${key.label}\" title=\"Edit key\">\n            <i class=\"bi bi-pencil\"></i>\n          </button>\n          <button class=\"btn btn-sm btn-outline-danger delete-btn\" data-id=\"${key.id}\" title=\"Delete key\">\n            <i class=\"bi bi-trash\"></i>\n          </button>\n        </td>\n      `;\n      tableBody.appendChild(row);\n    });\n  };\n\n  keyModalEl.addEventListener('show.bs.modal', (event) => {\n    const button = event.relatedTarget;\n    const id = button ? button.getAttribute('data-id') : null;\n    const label = button ? button.getAttribute('data-label') : '';\n\n    keyForm.reset();\n    keyIdInput.value = id || '';\n    keyLabelInput.value = label || '';\n    keyModalLabel.textContent = id ? 'Edit API Key' : 'Create API Key';\n  });\n\n  keyModalEl.addEventListener('shown.bs.modal', () => {\n    keyLabelInput.focus();\n  });\n\n  keyForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const id = keyIdInput.value;\n    const label = keyLabelInput.value;\n    const url = id ? `/api/v3/api-keys/${id}` : '/api/v3/api-keys';\n    const method = id ? 'PUT' : 'POST';\n\n    try {\n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ label })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: 'Failed to save key' }));\n        throw new Error(errorData.message);\n      }\n\n      keyModal.hide();\n\n      keyModalEl.addEventListener(\n        'hidden.bs.modal',\n        async () => {\n          if (method === 'POST') {\n            const { apiKey } = await response.json();\n            newApiKeyInput.value = apiKey;\n            showKeyModal.show();\n          } else {\n            showToast('API Key updated successfully.');\n            await fetchKeys();\n          }\n        },\n        { once: true }\n      );\n    } catch (error) {\n      console.error(error);\n      showToast(error.message || 'Error saving API key.', 'danger');\n    }\n  });\n\n  const deleteKey = async (id) => {\n    if (!confirm('Are you sure you want to delete this API key?')) {\n      return;\n    }\n    try {\n      const response = await fetch(`/api/v3/api-keys/${id}`, { method: 'DELETE' });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: 'Failed to delete key' }));\n        throw new Error(errorData.message);\n      }\n      showToast('API Key deleted successfully.');\n      await fetchKeys();\n    } catch (error) {\n      console.error(error);\n      showToast(error.message || 'Error deleting API key.', 'danger');\n    }\n  };\n\n  // Event Listeners\n  createKeyBtn.addEventListener('click', () => {\n    // Manually trigger the modal via JS to avoid passing button as relatedTarget\n    keyModal.show();\n  });\n\n  // Removed manual refresh button; users can trigger updates via create/edit/delete actions.\n\n  tableBody.addEventListener('click', (e) => {\n    const editBtn = e.target.closest('.edit-btn');\n    if (editBtn) {\n      // The 'show.bs.modal' event will handle populating the form\n      const modalTrigger = document.createElement('button');\n      modalTrigger.style.display = 'none';\n      modalTrigger.setAttribute('data-bs-toggle', 'modal');\n      modalTrigger.setAttribute('data-bs-target', '#keyModal');\n      modalTrigger.setAttribute('data-id', editBtn.dataset.id);\n      modalTrigger.setAttribute('data-label', editBtn.dataset.label);\n      document.body.appendChild(modalTrigger);\n      modalTrigger.click();\n      document.body.removeChild(modalTrigger);\n      return;\n    }\n\n    const deleteBtn = e.target.closest('.delete-btn');\n    if (deleteBtn) {\n      deleteKey(deleteBtn.dataset.id);\n    }\n  });\n\n  copyKeyBtn.addEventListener('click', () => {\n    navigator.clipboard.writeText(newApiKeyInput.value).then(\n      () => {\n        const originalIcon = copyKeyBtn.innerHTML;\n        copyKeyBtn.innerHTML = '<i class=\"bi bi-check-lg\"></i>';\n        showToast('Copied to clipboard!');\n        setTimeout(() => {\n          copyKeyBtn.innerHTML = originalIcon;\n        }, 2000);\n      },\n      () => {\n        showToast('Failed to copy.', 'danger');\n      }\n    );\n  });\n\n  showKeyModalEl.addEventListener('hidden.bs.modal', fetchKeys);\n\n  // Initial fetch\n  fetchKeys();\n});\n"],
  "mappings": "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",
  "names": []
}
