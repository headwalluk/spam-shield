(()=>{typeof window.assertBootstrapReady=="function"&&window.assertBootstrapReady("reset-password");function a(e,t,n){if(!e)return;e.innerHTML="";let s=document.createElement("div");s.className=`alert alert-${t} py-2 mb-0`,s.textContent=n,e.appendChild(s)}function c(e){return e?(e.classList.add("was-validated"),e.checkValidity()):!1}var i=document.getElementById("loadingSpinner"),l=()=>{i&&i.classList.remove("d-none","fade")},u=()=>{i&&(i.classList.add("fade"),setTimeout(()=>{i.classList.add("d-none")},150))};async function m(e){e.preventDefault();let t=e.currentTarget,n=document.getElementById("reset-request-result");if(!c(t)){a(n,"danger","Please fix the highlighted fields.");return}let s=Object.fromEntries(new FormData(t));l();try{let r=await fetch("/api/v3/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({email:s.email})});if(r.ok){let o=await r.json().catch(()=>({})),d="If the email exists, a reset link has been sent.";o&&o.resetToken&&(d+=` Dev token: ${o.resetToken}`),a(n,"success",d),t.reset(),t.classList.remove("was-validated");return}a(n,"danger","Reset request failed.")}catch{a(n,"danger","Network error. Please try again.")}finally{u()}}async function f(e){e.preventDefault();let t=e.currentTarget,n=document.getElementById("reset-consume-result");if(!c(t)){a(n,"danger","Please fix the highlighted fields.");return}let s=Object.fromEntries(new FormData(t));l();try{let r=await fetch("/api/v3/auth/reset-password/consume",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({token:s.token,password:s.password})});if(r.status===204){a(n,"success","Password updated. You can now log in."),t.reset(),t.classList.remove("was-validated");return}let o=await r.json().catch(()=>({}));if(r.status===400&&o.error==="RESET_INVALID"){a(n,"warning","Invalid or expired token.");return}a(n,"danger","Reset failed. Please try again.")}catch{a(n,"danger","Network error. Please try again.")}finally{u()}}function g(){let t=new URL(window.location.href).searchParams.get("token");if(t){let n=document.getElementById("reset-token");n&&(n.value=t);let s=document.getElementById("reset-consume-form");s&&s.scrollIntoView({behavior:"smooth"})}}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("reset-request-form"),t=document.getElementById("reset-consume-form");e&&e.addEventListener("submit",m),t&&t.addEventListener("submit",f),g()});})();
