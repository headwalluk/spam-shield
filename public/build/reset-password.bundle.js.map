{
  "version": 3,
  "sources": ["../js/reset-password.js"],
  "sourcesContent": ["// Optional: verify Bootstrap JS readiness early\nif (typeof window.assertBootstrapReady === 'function') {\n  window.assertBootstrapReady('reset-password');\n}\n// Reset password page logic\n\nfunction setStatus(el, type, message) {\n  if (!el) {\n    return;\n  }\n  el.innerHTML = '';\n  const div = document.createElement('div');\n  div.className = `alert alert-${type} py-2 mb-0`;\n  div.textContent = message;\n  el.appendChild(div);\n}\n\nfunction validateForm(form) {\n  if (!form) {\n    return false;\n  }\n  form.classList.add('was-validated');\n  return form.checkValidity();\n}\n\nconst loadingSpinner = document.getElementById('loadingSpinner');\n\nconst showSpinner = () => {\n  if (loadingSpinner) {\n    loadingSpinner.classList.remove('d-none', 'fade');\n  }\n};\n\nconst hideSpinner = () => {\n  if (loadingSpinner) {\n    loadingSpinner.classList.add('fade');\n    setTimeout(() => {\n      loadingSpinner.classList.add('d-none');\n    }, 150); // Match Bootstrap's fade duration\n  }\n};\n\nasync function submitRequest(e) {\n  e.preventDefault();\n  const form = e.currentTarget;\n  const resultEl = document.getElementById('reset-request-result');\n  if (!validateForm(form)) {\n    setStatus(resultEl, 'danger', 'Please fix the highlighted fields.');\n    return;\n  }\n  const data = Object.fromEntries(new FormData(form));\n  showSpinner();\n  try {\n    const res = await fetch('/api/v3/auth/reset-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'same-origin',\n      body: JSON.stringify({ email: data.email })\n    });\n    if (res.ok) {\n      const payload = await res.json().catch(() => ({}));\n      let msg = 'If the email exists, a reset link has been sent.';\n      if (payload && payload.resetToken) {\n        msg += ` Dev token: ${payload.resetToken}`;\n      }\n      setStatus(resultEl, 'success', msg);\n      form.reset();\n      form.classList.remove('was-validated');\n      return;\n    }\n    setStatus(resultEl, 'danger', 'Reset request failed.');\n  } catch {\n    setStatus(resultEl, 'danger', 'Network error. Please try again.');\n  } finally {\n    hideSpinner();\n  }\n}\n\nasync function submitConsume(e) {\n  e.preventDefault();\n  const form = e.currentTarget;\n  const resultEl = document.getElementById('reset-consume-result');\n  if (!validateForm(form)) {\n    setStatus(resultEl, 'danger', 'Please fix the highlighted fields.');\n    return;\n  }\n  const data = Object.fromEntries(new FormData(form));\n  showSpinner();\n  try {\n    const res = await fetch('/api/v3/auth/reset-password/consume', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'same-origin',\n      body: JSON.stringify({ token: data.token, password: data.password })\n    });\n    if (res.status === 204) {\n      setStatus(resultEl, 'success', 'Password updated. You can now log in.');\n      form.reset();\n      form.classList.remove('was-validated');\n      return;\n    }\n    const payload = await res.json().catch(() => ({}));\n    if (res.status === 400 && payload.error === 'RESET_INVALID') {\n      setStatus(resultEl, 'warning', 'Invalid or expired token.');\n      return;\n    }\n    setStatus(resultEl, 'danger', 'Reset failed. Please try again.');\n  } catch {\n    setStatus(resultEl, 'danger', 'Network error. Please try again.');\n  } finally {\n    hideSpinner();\n  }\n}\n\nfunction initFromUrl() {\n  const url = new URL(window.location.href);\n  const token = url.searchParams.get('token');\n  if (token) {\n    const tokenInput = document.getElementById('reset-token');\n    if (tokenInput) {\n      tokenInput.value = token;\n    }\n    // Scroll to consume section\n    const consumeForm = document.getElementById('reset-consume-form');\n    if (consumeForm) {\n      consumeForm.scrollIntoView({ behavior: 'smooth' });\n    }\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const reqForm = document.getElementById('reset-request-form');\n  const consumeForm = document.getElementById('reset-consume-form');\n  if (reqForm) {\n    reqForm.addEventListener('submit', submitRequest);\n  }\n  if (consumeForm) {\n    consumeForm.addEventListener('submit', submitConsume);\n  }\n  initFromUrl();\n});\n"],
  "mappings": "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",
  "names": []
}
