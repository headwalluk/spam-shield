(()=>{typeof window.assertBootstrapReady=="function"&&window.assertBootstrapReady("security");document.addEventListener("DOMContentLoaded",()=>{let c=document.getElementById("security-form"),n=document.getElementById("email"),d=document.getElementById("password"),i=document.querySelector(".toast-container"),s=(e,o="success")=>{let t=document.createElement("div");if(t.className=`toast align-items-center text-white bg-${o} border-0`,t.role="alert",t.ariaLive="assertive",t.ariaAtomic="true",t.innerHTML=`
      <div class="d-flex">
        <div class="toast-body">${e}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `,!i){console.error("Toast container not found!");return}i.appendChild(t),window.bootstrap&&(new window.bootstrap.Toast(t,{autohide:!0,delay:5e3}).show(),t.addEventListener("hidden.bs.toast",()=>t.remove()))},l=async()=>{try{let e=await fetch("/api/v3/auth/me");if(!e.ok)throw new Error("Failed to fetch user data");let o=await e.json();n.value=o.email}catch(e){console.error("Error loading user data:",e),s("Could not load your current information.","danger")}};c.addEventListener("submit",async e=>{e.preventDefault();let o=n.value,t=d.value,r={email:o};t&&(r.password=t);try{let a=await fetch("/api/v3/auth/me",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){let u=await a.json().catch(()=>({message:"Failed to update"}));throw new Error(u.message||"An unknown error occurred")}s("Your details have been updated successfully."),d.value=""}catch(a){console.error("Error updating details:",a),s(`Update failed: ${a.message}`,"danger")}}),l()});})();
