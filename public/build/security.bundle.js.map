{
  "version": 3,
  "sources": ["../js/security.js"],
  "sourcesContent": ["// Optional: verify Bootstrap JS readiness\nif (typeof window.assertBootstrapReady === 'function') {\n  window.assertBootstrapReady('security');\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const securityForm = document.getElementById('security-form');\n  const emailInput = document.getElementById('email');\n  const passwordInput = document.getElementById('password');\n  const toastContainer = document.querySelector('.toast-container');\n\n  const showToast = (message, type = 'success') => {\n    const toastEl = document.createElement('div');\n    toastEl.className = `toast align-items-center text-white bg-${type} border-0`;\n    toastEl.role = 'alert';\n    toastEl.ariaLive = 'assertive';\n    toastEl.ariaAtomic = 'true';\n    toastEl.innerHTML = `\n      <div class=\"d-flex\">\n        <div class=\"toast-body\">${message}</div>\n        <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n      </div>\n    `;\n    if (!toastContainer) {\n      console.error('Toast container not found!');\n      return;\n    }\n    toastContainer.appendChild(toastEl);\n    if (window.bootstrap) {\n      const toast = new window.bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });\n      toast.show();\n      toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());\n    }\n  };\n\n  const loadCurrentUser = async () => {\n    try {\n      const response = await fetch('/api/v3/auth/me');\n      if (!response.ok) {\n        throw new Error('Failed to fetch user data');\n      }\n      const user = await response.json();\n      emailInput.value = user.email;\n    } catch (error) {\n      console.error('Error loading user data:', error);\n      showToast('Could not load your current information.', 'danger');\n    }\n  };\n\n  securityForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = emailInput.value;\n    const password = passwordInput.value;\n\n    const payload = { email };\n    if (password) {\n      payload.password = password;\n    }\n\n    try {\n      const response = await fetch('/api/v3/auth/me', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: 'Failed to update' }));\n        throw new Error(errorData.message || 'An unknown error occurred');\n      }\n\n      showToast('Your details have been updated successfully.');\n      passwordInput.value = ''; // Clear password field after successful update\n    } catch (error) {\n      console.error('Error updating details:', error);\n      showToast(`Update failed: ${error.message}`, 'danger');\n    }\n  });\n\n  loadCurrentUser();\n});\n"],
  "mappings": ";;AACA,MAAI,OAAO,OAAO,yBAAyB,YAAY;AACrD,WAAO,qBAAqB,UAAU;AAAA,EACxC;AAEA,WAAS,iBAAiB,oBAAoB,MAAM;AAClD,UAAM,eAAe,SAAS,eAAe,eAAe;AAC5D,UAAM,aAAa,SAAS,eAAe,OAAO;AAClD,UAAM,gBAAgB,SAAS,eAAe,UAAU;AACxD,UAAM,iBAAiB,SAAS,cAAc,kBAAkB;AAEhE,UAAM,YAAY,CAAC,SAAS,OAAO,cAAc;AAC/C,YAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,cAAQ,YAAY,0CAA0C,IAAI;AAClE,cAAQ,OAAO;AACf,cAAQ,WAAW;AACnB,cAAQ,aAAa;AACrB,cAAQ,YAAY;AAAA;AAAA,kCAEU,OAAO;AAAA;AAAA;AAAA;AAIrC,UAAI,CAAC,gBAAgB;AACnB,gBAAQ,MAAM,4BAA4B;AAC1C;AAAA,MACF;AACA,qBAAe,YAAY,OAAO;AAClC,UAAI,OAAO,WAAW;AACpB,cAAM,QAAQ,IAAI,OAAO,UAAU,MAAM,SAAS,EAAE,UAAU,MAAM,OAAO,IAAK,CAAC;AACjF,cAAM,KAAK;AACX,gBAAQ,iBAAiB,mBAAmB,MAAM,QAAQ,OAAO,CAAC;AAAA,MACpE;AAAA,IACF;AAEA,UAAM,kBAAkB,YAAY;AAClC,UAAI;AACF,cAAM,WAAW,MAAM,MAAM,iBAAiB;AAC9C,YAAI,CAAC,SAAS,IAAI;AAChB,gBAAM,IAAI,MAAM,2BAA2B;AAAA,QAC7C;AACA,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,mBAAW,QAAQ,KAAK;AAAA,MAC1B,SAAS,OAAO;AACd,gBAAQ,MAAM,4BAA4B,KAAK;AAC/C,kBAAU,4CAA4C,QAAQ;AAAA,MAChE;AAAA,IACF;AAEA,iBAAa,iBAAiB,UAAU,OAAO,MAAM;AACnD,QAAE,eAAe;AACjB,YAAM,QAAQ,WAAW;AACzB,YAAM,WAAW,cAAc;AAE/B,YAAM,UAAU,EAAE,MAAM;AACxB,UAAI,UAAU;AACZ,gBAAQ,WAAW;AAAA,MACrB;AAEA,UAAI;AACF,cAAM,WAAW,MAAM,MAAM,mBAAmB;AAAA,UAC9C,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAC9C,MAAM,KAAK,UAAU,OAAO;AAAA,QAC9B,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AAChB,gBAAM,YAAY,MAAM,SAAS,KAAK,EAAE,MAAM,OAAO,EAAE,SAAS,mBAAmB,EAAE;AACrF,gBAAM,IAAI,MAAM,UAAU,WAAW,2BAA2B;AAAA,QAClE;AAEA,kBAAU,8CAA8C;AACxD,sBAAc,QAAQ;AAAA,MACxB,SAAS,OAAO;AACd,gBAAQ,MAAM,2BAA2B,KAAK;AAC9C,kBAAU,kBAAkB,MAAM,OAAO,IAAI,QAAQ;AAAA,MACvD;AAAA,IACF,CAAC;AAED,oBAAgB;AAAA,EAClB,CAAC;",
  "names": []
}
